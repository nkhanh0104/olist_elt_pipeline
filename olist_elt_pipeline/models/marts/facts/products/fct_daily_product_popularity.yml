version: 2

models:
  - name: fct_daily_product_popularity
    description: >
      ğŸ† Fact table showing top-selling products by date.
      ğŸ” Each row represents a product sold on a specific day (`date_day`), supporting breakdown by year, month, quarter.
      ğŸ“Š Used for building product sales charts, category performance, and identifying high-volume SKUs.
    tags: ["fact", "daily_product_popularity"]
    columns:
      - name: product_id
        description: >
          ğŸ” ID of the product sold. May appear multiple times across different time periods (e.g., per day, month, or quarter).
          ğŸ¯ Expected: varchar, not null.
          ğŸ“Š Used to group product-level metrics.
        tests:
          - not_null:
              severity: error
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar # Must match with data type in Snowflake but not include length (e.g., âŒ varchar(16777216) ).
              severity: error

      - name: product_category_name
        description: >
          ğŸ—‚ï¸ The product's category in Portuguese.
          ğŸ¯ Expected: varchar, not null.
          ğŸ“Š Useful for cross-referencing raw data or building multilingual charts.
        tests:
          - not_null:
              severity: error
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar # Must match with data type in Snowflake but not include length (e.g., âŒ varchar(16777216) ).
              severity: error

      - name: product_category_name_english
        description: >
          ğŸ“ Translated product category name in English.
          ğŸ¯ Expected: varchar, not null.
          ğŸ“Š Enables intuitive grouping, filtering, and ranking of product categories in dashboards for business users.
        tests:
          - not_null:
              severity: error
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: varchar # Must match with data type in Snowflake but not include length (e.g., âŒ varchar(16777216) ).
              severity: error

      - name: date_day
        description: >
          ğŸ“… The specific calendar date of the order.
              Already strictly validated in `dim_dates`.
          ğŸ¯ Expected: date, not null, unique.
          ğŸ“Š Used as the base time dimension for grouping revenue.

      - name: year
        description: >
          ğŸ”¢ Year extracted from `date_day` of the order.
              Already strictly validated in `dim_dates`.
          ğŸ¯ Expected: int, not null, min 2016, max 2018.
          ğŸ“Š Supports filtering and grouping charts by year.

      - name: month
        description: >
          ğŸ”¢ Month (1 to 12) extracted from `date_day` of the order.
              Already strictly validated in `dim_dates`.
          ğŸ¯ Expected: int, not null, min 1, max 12.
          ğŸ“Š Supports grouping by month or monthly trends.

      - name: quarter
        description: >
          ğŸ“¦ Quarter (1-4) of the order.
              Already strictly validated in `dim_dates`.
          ğŸ¯ Expected: int, not null, min 1, max 4.
          ğŸ“Š Used in charts grouped by quarter.

      - name: total_quantity_sold
        description: >
          ğŸ”¢ Total number of times the products appeared in orders.
          ğŸ¯ Expected: int, not null, min 1.
          ğŸ“Š Key metric for identifying best-selling products based on volume, not just value.
        tests:
          - not_null:
              severity: error
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number # Must match with data type in Snowflake but not include length (e.g., âŒ number(18,0) ).
              severity: error
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 1
              severity: error

      - name: total_revenue
        description: >
          ğŸ’° Total revenue generated by the product across all orders.
          ğŸ¯ Expected: numeric(38, 2), not null, min 0.00.
          ğŸ“Š Helps rank products by sales value, not just volume.
        tests:
          - not_null:
              severity: error
          - dbt_expectations.expect_column_values_to_be_of_type:
              column_type: number # Must match with data type in Snowflake but not include length (e.g., âŒ number(38,2) ).
              severity: error
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0.00
              severity: error
